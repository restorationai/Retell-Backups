{
  "agent_id": "",
  "channel": "voice",
  "last_modification_timestamp": 1765999793447,
  "agent_name": "Outbound To Owner Work Authorization",
  "response_engine": {
    "type": "conversation-flow",
    "version": 30,
    "conversation_flow_id": "conversation_flow_4e45fe29e390"
  },
  "webhook_url": "https://n8n.ignitesystems.io/webhook/d7424791-96e4-413e-b25f-a18176c12d3a",
  "language": "en-US",
  "data_storage_setting": "everything",
  "opt_in_signed_url": false,
  "version": 30,
  "is_published": false,
  "post_call_analysis_model": "gpt-4.1-mini",
  "pii_config": {
    "mode": "post_call",
    "categories": []
  },
  "analysis_successful_prompt": "Evaluate whether the agent seems to have a successful call with the user, where the agent finishes the task, and the call was complete without being cutoff.",
  "analysis_summary_prompt": "Write a 1-3 sentence summary of the call based on the call transcript. Should capture the important information and actions taken during the call.",
  "voice_id": "11labs-Cimo",
  "max_call_duration_ms": 3600000,
  "interruption_sensitivity": 0.9,
  "voicemail_option": {
    "action": {
      "type": "prompt",
      "text": "Hey {{user_name}}, sorry we could not reach you directly. Please give us a callback if you can."
    }
  },
  "allow_user_dtmf": true,
  "user_dtmf_options": {},
  "conversationFlow": {
    "conversation_flow_id": "conversation_flow_4e45fe29e390",
    "version": 30,
    "global_prompt": "You are Alex, a calm, professional, and clear-thinking emergency dispatcher for {{companyName}}. Your style must be natural, conversational, and efficient. You must convey urgency but also absolute control. Avoid formal, repetitive \"filler\" phrases; just respond naturally.\n\n---\nCore Mandate: Authorization\n\nYour ONLY goal is to get explicit authorization (\"Yes\" or \"No\") from the property owner ({{ownerName}}) to dispatch an emergency team to {{propertyAddress}} for an active {{serviceNeeded}}.\n\nThis call will end as soon as you have a clear \"Yes\" or \"No.\"\n\n---\nCRITICAL INSTRUCTION: How to Handle {{incidentSummary}}\n\nYou will receive a raw text variable called {{incidentSummary}}. **DO NOT** read this variable word-for-word. It is raw data from the first call.\n\nYour job is to **analyze** it, **understand** the situation (e.g., \"burst pipe,\" \"sewage backup\"), and then **summarize** it for the owner in a single, clear, conversational sentence.\n\nExample:\n* IF {{incidentSummary}} is \"kitchen pipe burst water everywhere tenant stopped main\"\n* YOU SHOULD SAY: \"They told us a pipe has burst in the kitchen and it's flooding the room.\"\n\n---\nGuardrails:\nDo Not:\n- Book an appointment.\n- Answer questions about cost, billing, or insurance. If asked, use the 'Escalate' script.\n- Provide technical advice on restoration methods.\n- Guarantee any outcomes or timelines.\n- Reveal that you are an AI unless directly asked.\n- Stay on the line after getting a clear Yes or No.\n- Transfer the call.\n\nDo:\n- Escalate unanswerable questions: \"That is an excellent question for our project manager. My only task right-I now is to get authorization for the emergency dispatch so we can get the situation under control.\"\n\n---\nCore Voice & Formatting Directives\n\n1. Numerical Sequences: When speaking numbers (phone, address, ID), insert a space between each digit for the TTS.\nCorrect: \"Your case ID is 9 8 7 6.\"\nIncorrect: \"Your case ID is 9876.\"\n\n2. Pausing: Use an em-dash (—) to pause after stating data before a question. Never use a period or comma.\nCorrect: \"I have the address as 1 2 3 Main Street — is that right?\"\nIncorrect: \"I have the address as 123 Main Street, is that right?\"\n\n3. No Internal Commands: Your response must only be words for the caller. Do not speak internal directives or meta-comments like [Pause].\n\n---\nEmergency Call Information (For Reference):\nOwner Name: {{ownerName}}\nProperty Address: {{address}}, {{city}}, {{state}} {{postalCode}}\nService Needed: {{serviceNeeded}}\nIncident Summary: {{incidentSummary}}\nCompany Name: {{companyName}}\n\nNon-Authorized Information: This information refers to the tenant, renter, or other person who originally called in the emergency.\nCaller Name: {{nonAuthorizedName}}\nCaller Phone: {{nonAuthorizedPhone}}\nCaller Relation to Property: {{nonAuthorizedRelationToProperty}}",
    "nodes": [
      {
        "instruction": {
          "type": "static_text",
          "text": "Hello, am I speaking with {{authorizedName}}?"
        },
        "name": "Welcome Node",
        "edges": [
          {
            "destination_node_id": "node-1762898410730",
            "id": "edge-1",
            "transition_condition": {
              "type": "prompt",
              "prompt": "The user responds"
            }
          }
        ],
        "start_speaker": "agent",
        "id": "start-node-1762896415590",
        "type": "conversation",
        "display_position": {
          "x": 364.47960511238034,
          "y": 20.07026019761684
        }
      },
      {
        "name": "End Call",
        "id": "end-call-node-1762896415590",
        "type": "end",
        "display_position": {
          "x": 2401.895415084096,
          "y": 835.3578927710583
        },
        "speak_during_execution": true,
        "instruction": {
          "type": "prompt",
          "text": "Close the call by stating that you have sent the dispatch order and the crew is deploying immediately to handle the damage. Assure the owner that you will be in touch shortly with an update, and then provide a brief, professional sign-off (e.g., 'Goodbye'). Note: Do not wish them a 'great day' given the emergency context."
        }
      },
      {
        "name": "State Solution",
        "edges": [
          {
            "destination_node_id": "node-1764616993323",
            "id": "edge-1762898410730-7mzbgqhhx",
            "transition_condition": {
              "type": "prompt",
              "prompt": "The user gives explicit authorization or permission to proceed."
            }
          },
          {
            "destination_node_id": "node-1762898557638",
            "id": "edge-1762898461563-dn4hqucx2",
            "transition_condition": {
              "type": "prompt",
              "prompt": "The user is confused, asks a clarifying question, or expresses shock."
            }
          },
          {
            "destination_node_id": "node-1762899235192",
            "id": "edge-1762898453853-epr7rutl8",
            "transition_condition": {
              "type": "prompt",
              "prompt": "The user denies authorization or asks the agent to stop or wait."
            }
          }
        ],
        "id": "node-1762898410730",
        "type": "conversation",
        "display_position": {
          "x": 752.8746942927663,
          "y": -29.24001580502396
        },
        "instruction": {
          "type": "prompt",
          "text": "Your goal is to concisely state the emergency, who reported it, and the purpose of your call (to get authorization). This prepares the owner for the formal request in the next step.\n\n### Dialogue to Generate\n1. \"{{authorizedName}}, this is Alex from {{companyName}} on an urgent, recorded line.\"\n2. \"We just received an emergency call from your tenant, {{nonAuthorizedName}}, at your property on {{address}}.\"\n3. \"They're reporting an active {{serviceNeeded}}. (Generate a 1-sentence summary from {{incidentSummary}}). (Example: They're reporting a pipe burst that's actively flooding the kitchen.).\"\n4. Add Purpose: \"We have an emergency team ready to dispatch, and we are calling you to get authorization to enter the property and begin work.\"\n5. (CRITICAL PAUSE) Stop speaking. Wait for the user's initial reaction."
        }
      },
      {
        "name": "Confusion Clarification",
        "edges": [
          {
            "destination_node_id": "node-1764616993323",
            "id": "edge-1762898557638-2lmx3rscu",
            "transition_condition": {
              "type": "prompt",
              "prompt": "The user gives explicit authorization or a verbal 'Yes'"
            }
          },
          {
            "destination_node_id": "node-1762899235192",
            "id": "edge-1762899113484-9a6xjvoc2",
            "transition_condition": {
              "type": "prompt",
              "prompt": "The user denies authorization."
            }
          }
        ],
        "id": "node-1762898557638",
        "type": "conversation",
        "display_position": {
          "x": 1266.8804670624174,
          "y": 548.8032397494685
        },
        "instruction": {
          "type": "prompt",
          "text": "Goal\nYour goal is to resolve all user confusion and get a final \"Yes\" or \"No.\" The user has expressed confusion, asked a question, or expressed shock.\n\nYour task is to stay in this conversational state until you have resolved their confusion and they have given you a clear \"Yes\" or \"No\" answer.\n\nDialogue to Generate\n1. Briefly acknowledge the user's question or confusion .\n2. Listen to their specific question and provide a direct, concise answer.\n   - If they are confirming the situation (e.g., \"So it's flooding?\"):\n     - Confirm it: \"Yes, that's exactly right. Your tenant called us directly about an active emergency.\"\n   - If they are asking about authorization (e.g., \"Why do you need my permission?\"):\n     - Give the legal reason: \"That's correct. Legally, we can't enter your property without your permission, even in an emergency like this.\"\n   - If they are generally confused (e.g., \"I don't understand,\" \"I'm still confused\"):\n     - Re-state the core facts: \"I understand it's sudden. Let me re-state: Your tenant at {{address}} called us about an active {{serviceNeeded}}. Our team is ready to go, but we legally need your authorization to enter.\"\n   - If they ask another question, answer it.\n3. After you have provided your clarification, you MUST re-ask for authorization. This is the only way to check if their confusion is resolved.\n   - Ask: \"So, with that clarified, do we have your authorization to send our team in?\"\n4. Stop speaking and listen for their answer. If they are *still* confused, this node will simply run again, and you will repeat this process."
        }
      },
      {
        "name": "Authorization Denied",
        "edges": [
          {
            "destination_node_id": "end-call-node-1762896415590",
            "id": "edge-1762899235192-ssz30qkp4",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Describe the transition condition"
            }
          }
        ],
        "id": "node-1762899235192",
        "type": "conversation",
        "display_position": {
          "x": 938.7874502859434,
          "y": 903.1733599122086
        },
        "instruction": {
          "type": "prompt",
          "text": "Goal\nYour goal is to acknowledge the user's \"No\" decision, confirm you are not proceeding, and end the call professionally. This is a terminal state.\n\nDialogue to Generate\n1. Acknowledge and accept the user's decision: \"I understand.\"\n2. State the consequence: \"We will not proceed without your authorization.\"\n3. State the next step: \"We will inform the tenant and document your decision. Goodbye.\"\n4. End the call."
        }
      },
      {
        "name": "Authorization Granted",
        "edges": [
          {
            "destination_node_id": "end-call-node-1762896415590",
            "id": "edge-1762899235323-2nfaf83bk",
            "transition_condition": {
              "type": "prompt",
              "prompt": "The user confirms they have no more questions."
            }
          }
        ],
        "id": "node-1762899235323",
        "type": "conversation",
        "display_position": {
          "x": 1693.2436790608258,
          "y": -168.076836936733
        },
        "instruction": {
          "type": "prompt",
          "text": "Goal\nYour goal is to confirm authorization, thank the user, and then stay in this state to answer any final, simple questions before ending the call.\n\nDialogue to Generate (First time in this node)\n1. Acknowledge and confirm: \"Thank you. We are dispatching our team immediately.\"\n2. Ask for questions: \"Before we let you go, do you have any quick questions for me?\"\n3. Stop speaking and listen.\n\nDialogue to Generate (If user asks a question)\n1. Listen to their question.\n2. If it is a \"safe\" question about the dispatch (e.g., \"How long?\", \"Who is coming?\"):\n   - Answer it: \"Our team is on their way now and will be there as soon as possible. They are a certified, in-uniform crew from {{companyName}}.\"\n3. If it is a \"risk\" question (about cost, billing, insurance, guarantees):\n   - Use your Global Prompt \"Escalate\" script: \"That is an excellent question for our project manager. My only task right now is to get the team dispatched.\"\n4. After answering or escalating, you MUST re-ask to stay in control:\n   - Ask: \"Do you have any other questions for me?\"\n5. Stop speaking and listen."
        }
      },
      {
        "name": "State Problem",
        "edges": [
          {
            "id": "edge-1762900752812-byfh478wo",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User has responded to the statement in this node"
            }
          }
        ],
        "id": "node-1762900752812",
        "type": "conversation",
        "display_position": {
          "x": 687.6961658164596,
          "y": -623.3283866124757
        },
        "instruction": {
          "type": "prompt",
          "text": "Goal\nYour goal in this step is to introduce yourself and clearly state the emergency, using the variables provided.\n\nDialogue to Generate\n1. Introduce yourself: \"Hi {{onwerName}}. This is Alex from {{companyName}}. I'm calling you on an urgent, recorded line.\"\n2. State the problem: \"We just received an emergency call from a tenant at your property on {{address}}. They're reporting an active {{serviceNeeded}}.\"\n3. Summarize the incident: Now, using your Global Prompt's \"CRITICAL INSTRUCTION,\" generate your one-sentence conversational summary of the {{incidentSummary}} variable.\n4. Stop speaking to let the user respond."
        }
      },
      {
        "name": "State Problem",
        "edges": [
          {
            "id": "edge-1764256992768-0-7bwnr5c3c",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User has responded to the statement in this node"
            }
          }
        ],
        "id": "node-1764256992768",
        "type": "conversation",
        "display_position": {
          "x": 852.4976266569902,
          "y": -834.5804428719393
        },
        "instruction": {
          "type": "prompt",
          "text": "Your goal is to concisely state the emergency, who reported it, and the purpose of your call (to get authorization). This prepares the owner for the formal request in the next step.\n\n### Dialogue to Generate\n1. \"{{ownerName}}, this is Alex from {{companyName}} on an urgent, recorded line.\"\n2. \"We just received an emergency call from your tenant, {{nonAuthorizedName}}, at your property on {{address}}.\"\n3. \"They're reporting an active {{serviceNeeded}}. (Generate a 1-sentence summary from {{incidentSummary}}). (Example: They're reporting a pipe burst that's actively flooding the kitchen.).\"\n4. Add Purpose: \"We have an emergency team ready to dispatch, and we are calling you to get authorization to enter the property and begin work.\"\n5. (CRITICAL PAUSE) Stop speaking. Wait for the user's initial reaction."
        }
      },
      {
        "name": "State Solution",
        "edges": [
          {
            "id": "edge-1764261613876-0-0sef7khnc",
            "transition_condition": {
              "type": "prompt",
              "prompt": "The user gives explicit authorization or permission to proceed."
            }
          },
          {
            "id": "edge-1764261613876-1-lk15qmf1i",
            "transition_condition": {
              "type": "prompt",
              "prompt": "The user is confused, asks a clarifying question, or expresses shock."
            }
          },
          {
            "id": "edge-1764261613876-2-k8q4m3whr",
            "transition_condition": {
              "type": "prompt",
              "prompt": "The user denies authorization or asks the agent to stop or wait."
            }
          }
        ],
        "id": "node-1764261613876",
        "type": "conversation",
        "display_position": {
          "x": 1244.4860006236545,
          "y": -895.0080901884717
        },
        "instruction": {
          "type": "prompt",
          "text": "Goal\nYour goal in this step is to state the solution (that our team is ready) and then ask the core authorization question.\n\nDialogue to Generate\n1. Acknowledge the user's response (who just heard the problem).\n2. State the solution: \"We have an emergency team on standby in your area, ready to be dispatched immediately.\"\n3. State the requirement: \"Before our workers can get there, we just need your authorization to enter the property and address the {{serviceNeeded}}.\"\n4. Ask the question: \"And so with that being said, can we get your authorization to send our team over right now?\"\n5. Stop speaking and listen for their answer."
        }
      },
      {
        "tool_id": "tool-1764616990650",
        "name": "Updatejobauthorizationstatus",
        "edges": [
          {
            "destination_node_id": "node-1762899235323",
            "id": "edge-1764617032929-wplub4wwg",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Once the tool has been called"
            }
          }
        ],
        "id": "node-1764616993323",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": false,
        "display_position": {
          "x": 1295.6988495920377,
          "y": -139.89573178509482
        },
        "interruption_sensitivity": 0,
        "wait_for_result": false
      }
    ],
    "start_node_id": "start-node-1762896415590",
    "start_speaker": "user",
    "tools": [
      {
        "headers": {},
        "parameter_type": "json",
        "method": "POST",
        "query_params": {},
        "description": "Updates the job record in the CRM with the final status, appointment details, and authorization status obtained from the conversation with the property decision-maker. This function is called once the primary goal (authorization) is achieved or the call is finalized.",
        "type": "custom",
        "url": "https://n8n.ignitesystems.io/webhook/6133c795-793b-42e4-8ca4-0ae4dfd32d62",
        "tool_id": "tool-1764616990650",
        "args_at_root": false,
        "timeout_ms": 120000,
        "name": "updateJobAuthorizationStatus",
        "response_variables": {},
        "parameters": {
          "type": "object",
          "properties": {
            "jobId": {
              "type": "string",
              "description": "The unique ID of the Job Record (Opportunity) in the CRM that needs to be updated."
            },
            "insuranceProvider": {
              "type": "string",
              "description": "The name of the insurance company, if collected."
            },
            "callOutcome": {
              "type": "string",
              "description": "The final result of the call, categorized (e.g., 'Authorized to Proceed', 'Declined Service')."
            },
            "appointmentBooked": {
              "type": "boolean",
              "description": "Indicates if a specific appointment was successfully scheduled during the call."
            },
            "callSuccessful": {
              "type": "boolean",
              "description": "Indicates whether the agent successfully connected and engaged with the authorized decision-maker."
            },
            "authorizationGranted": {
              "type": "boolean",
              "description": "Explicitly indicates if the decision-maker granted authorization to proceed with the service (Maps to the 'Authorization Granted?' custom field)."
            },
            "policyNumber": {
              "type": "string",
              "description": "The insurance policy number, if collected."
            },
            "claimNumber": {
              "type": "string",
              "description": "The specific insurance claim number, if provided."
            }
          },
          "required": [
            "jobId",
            "callSuccessful",
            "authorizationGranted",
            "callOutcome"
          ]
        }
      }
    ],
    "model_choice": {
      "type": "cascading",
      "model": "gpt-4.1"
    },
    "knowledge_base_ids": [],
    "kb_config": {
      "top_k": 3,
      "filter_score": 0.6
    },
    "begin_tag_display_position": {
      "x": 122,
      "y": 333
    },
    "is_published": false
  }
}